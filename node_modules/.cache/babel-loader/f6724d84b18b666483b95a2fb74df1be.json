{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\it\\\\MyFirstProject\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\it\\\\MyFirstProject\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"C:\\\\it\\\\MyFirstProject\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{authAPI,securityAPI}from\"../API/API\";import{stopSubmit}from\"redux-form\";var SET_USER_DATA='auth_SET_USER_DATA';var GET_CAPTCHA_URL_SUCCESS='GET_CAPTCHA_URL_SUCCESS';var initialState={userId:null,email:null,login:null,isAuth:false,captchaUrl:null// if null, then captcha in not required\n};var AuthReducer=function AuthReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case SET_USER_DATA:case GET_CAPTCHA_URL_SUCCESS:return _objectSpread({},state,{},action.payload);default:return state;}};export var setAuthUserData=function setAuthUserData(userId,email,login,isAuth){return{type:SET_USER_DATA,payload:{userId:userId,email:email,login:login,isAuth:isAuth}};};export var getCaptchaUrlSuccess=function getCaptchaUrlSuccess(captchaUrl){return{type:GET_CAPTCHA_URL_SUCCESS,payload:{captchaUrl:captchaUrl}};};export var getAuthUserData=function getAuthUserData(){return(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var response,_response$data$data,id,email,_login;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return authAPI.authMe();case 2:response=_context.sent;if(response.data.resultCode===0){_response$data$data=response.data.data,id=_response$data$data.id,email=_response$data$data.email,_login=_response$data$data.login;dispatch(setAuthUserData(id,email,_login,true));}case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());};export var login=function login(email,password,rememberMe,captcha){return(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var response,message;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return authAPI.login(email,password,rememberMe,captcha);case 2:response=_context2.sent;if(response.data.resultCode===0){dispatch(getAuthUserData());}else{if(response.data.resultCode===10){dispatch(getCaptchaUrl());}message=response.data.messages.length>0?response.data.messages[0]:\"Some error\";dispatch(stopSubmit('login',{_error:message}));}case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}());};export var getCaptchaUrl=function getCaptchaUrl(){return(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var response,captchaUrl;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return securityAPI.getCaptchaUrl();case 2:response=_context3.sent;captchaUrl=response.data.url;dispatch(getCaptchaUrlSuccess(captchaUrl));case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}());};export var logout=function logout(){return(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return authAPI.logout();case 2:response=_context4.sent;if(response.data.resultCode===0){dispatch(getAuthUserData(null,null,null,false));};case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}());};export default AuthReducer;","map":{"version":3,"sources":["C:/it/MyFirstProject/src/redux/AuthReducer.js"],"names":["authAPI","securityAPI","stopSubmit","SET_USER_DATA","GET_CAPTCHA_URL_SUCCESS","initialState","userId","email","login","isAuth","captchaUrl","AuthReducer","state","action","type","payload","setAuthUserData","getCaptchaUrlSuccess","getAuthUserData","dispatch","authMe","response","data","resultCode","id","password","rememberMe","captcha","getCaptchaUrl","message","messages","length","_error","url","logout"],"mappings":"isCAAA,OAAQA,OAAR,CAAiBC,WAAjB,KAAmC,YAAnC,CACA,OAAQC,UAAR,KAAyB,YAAzB,CAEA,GAAMC,CAAAA,aAAa,CAAG,oBAAtB,CACA,GAAMC,CAAAA,uBAAuB,CAAG,yBAAhC,CAGA,GAAIC,CAAAA,YAAY,CAAG,CACfC,MAAM,CAAO,IADE,CAEfC,KAAK,CAAQ,IAFE,CAGfC,KAAK,CAAQ,IAHE,CAIfC,MAAM,CAAO,KAJE,CAKfC,UAAU,CAAG,IAAK;AALH,CAAnB,CASA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAkC,IAAjCC,CAAAA,KAAiC,2DAAzBP,YAAyB,IAAXQ,CAAAA,MAAW,2CAElD,OAAQA,MAAM,CAACC,IAAf,EACI,IAAKX,CAAAA,aAAL,CACA,IAAKC,CAAAA,uBAAL,CACI,wBACOQ,KADP,IAEOC,MAAM,CAACE,OAFd,EAIJ,QACI,MAAOH,CAAAA,KAAP,CARR,CAUH,CAZD,CAcA,MAAO,IAAMI,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACV,MAAD,CAASC,KAAT,CAAgBC,KAAhB,CAAuBC,MAAvB,QAAmC,CAC9DK,IAAI,CAAEX,aADwD,CACzCY,OAAO,CAAE,CAACT,MAAM,CAANA,MAAD,CAASC,KAAK,CAALA,KAAT,CAAgBC,KAAK,CAALA,KAAhB,CAAuBC,MAAM,CAANA,MAAvB,CADgC,CAAnC,EAAxB,CAGP,MAAO,IAAMQ,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAACP,UAAD,QAAiB,CACjDI,IAAI,CAAEV,uBAD2C,CAClBW,OAAO,CAAE,CAACL,UAAU,CAAVA,UAAD,CADS,CAAjB,EAA7B,CAIP,MAAO,IAAMQ,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,mGAAM,iBAAOC,QAAP,yLACVnB,CAAAA,OAAO,CAACoB,MAAR,EADU,QAC3BC,QAD2B,eAEjC,GAAIA,QAAQ,CAACC,IAAT,CAAcC,UAAd,GAA6B,CAAjC,CAAoC,qBACPF,QAAQ,CAACC,IAAT,CAAcA,IADP,CAC3BE,EAD2B,qBAC3BA,EAD2B,CACvBjB,KADuB,qBACvBA,KADuB,CAChBC,MADgB,qBAChBA,KADgB,CAEhCW,QAAQ,CAACH,eAAe,CAACQ,EAAD,CAAKjB,KAAL,CAAYC,MAAZ,CAAmB,IAAnB,CAAhB,CAAR,CACH,CALgC,sDAAN,iEAAxB,CAQP,MAAO,IAAMA,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,CAACD,KAAD,CAAQkB,QAAR,CAAkBC,UAAlB,CAA8BC,OAA9B,mGAA0C,kBAAOR,QAAP,kKACpCnB,CAAAA,OAAO,CAACQ,KAAR,CAAcD,KAAd,CAAqBkB,QAArB,CAA+BC,UAA/B,CAA2CC,OAA3C,CADoC,QACrDN,QADqD,gBAE3D,GAAIA,QAAQ,CAACC,IAAT,CAAcC,UAAd,GAA6B,CAAjC,CAAoC,CAChCJ,QAAQ,CAACD,eAAe,EAAhB,CAAR,CACH,CAFD,IAEM,CACF,GAAIG,QAAQ,CAACC,IAAT,CAAcC,UAAd,GAA6B,EAAjC,CAAoC,CAChCJ,QAAQ,CAACS,aAAa,EAAd,CAAR,CACH,CAEGC,OALF,CAKYR,QAAQ,CAACC,IAAT,CAAcQ,QAAd,CAAuBC,MAAvB,CAAgC,CAAhC,CAAoCV,QAAQ,CAACC,IAAT,CAAcQ,QAAd,CAAuB,CAAvB,CAApC,CAAgE,YAL5E,CAMFX,QAAQ,CAACjB,UAAU,CAAC,OAAD,CAAU,CAAC8B,MAAM,CAAEH,OAAT,CAAV,CAAX,CAAR,CACH,CAX0D,wDAA1C,mEAAd,CAaP,MAAO,IAAMD,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,oGAAM,kBAAOT,QAAP,qKACRlB,CAAAA,WAAW,CAAC2B,aAAZ,EADQ,QACzBP,QADyB,gBAEzBX,UAFyB,CAEZW,QAAQ,CAACC,IAAT,CAAcW,GAFF,CAG3Bd,QAAQ,CAACF,oBAAoB,CAACP,UAAD,CAArB,CAAR,CAH2B,wDAAN,mEAAtB,CAQP,MAAO,IAAMwB,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,oGAAM,kBAAOf,QAAP,0JACDnB,CAAAA,OAAO,CAACkC,MAAR,EADC,QAClBb,QADkB,gBAExB,GAAIA,QAAQ,CAACC,IAAT,CAAcC,UAAd,GAA6B,CAAjC,CAAoC,CAChCJ,QAAQ,CAACD,eAAe,CAAC,IAAD,CAAO,IAAP,CAAa,IAAb,CAAmB,KAAnB,CAAhB,CAAR,CACH,CACD,CALwB,wDAAN,mEAAf,CASP,cAAeP,CAAAA,WAAf","sourcesContent":["import {authAPI, securityAPI} from \"../API/API\";\r\nimport {stopSubmit} from \"redux-form\"\r\n\r\nconst SET_USER_DATA = 'auth_SET_USER_DATA';\r\nconst GET_CAPTCHA_URL_SUCCESS = 'GET_CAPTCHA_URL_SUCCESS';\r\n\r\n\r\nlet initialState = {\r\n    userId:      null,\r\n    email:       null,\r\n    login:       null,\r\n    isAuth:      false,\r\n    captchaUrl:  null // if null, then captcha in not required\r\n\r\n}\r\n\r\nconst AuthReducer = (state = initialState, action) => {\r\n\r\n    switch (action.type) {\r\n        case SET_USER_DATA:\r\n        case GET_CAPTCHA_URL_SUCCESS:\r\n            return {\r\n                ...state,\r\n                ...action.payload\r\n            }\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\nexport const setAuthUserData = (userId, email, login, isAuth) => ({\r\n    type: SET_USER_DATA, payload: {userId, email, login, isAuth}\r\n})\r\nexport const getCaptchaUrlSuccess = (captchaUrl) => ({\r\n    type: GET_CAPTCHA_URL_SUCCESS, payload: {captchaUrl}\r\n})\r\n\r\nexport const getAuthUserData = () => async (dispatch) => {\r\n    const response = await authAPI.authMe();\r\n    if (response.data.resultCode === 0) {\r\n        let {id, email, login} = response.data.data;\r\n        dispatch(setAuthUserData(id, email, login, true))\r\n    }\r\n}\r\n\r\nexport const login = (email, password, rememberMe, captcha) => async (dispatch) => {\r\n    const response = await authAPI.login(email, password, rememberMe, captcha)\r\n    if (response.data.resultCode === 0) {\r\n        dispatch(getAuthUserData())\r\n    } else{\r\n        if (response.data.resultCode === 10){\r\n            dispatch(getCaptchaUrl())\r\n        }\r\n\r\n        let message = response.data.messages.length > 0 ? response.data.messages[0] : \"Some error\"\r\n        dispatch(stopSubmit('login', {_error: message}))\r\n    }\r\n}\r\nexport const getCaptchaUrl = () => async (dispatch) => {\r\n    const response = await securityAPI.getCaptchaUrl()\r\n    const captchaUrl = response.data.url\r\n        dispatch(getCaptchaUrlSuccess(captchaUrl))\r\n}\r\n\r\n\r\n\r\nexport const logout = () => async (dispatch) => {\r\n    const response = await authAPI.logout()\r\n    if (response.data.resultCode === 0) {\r\n        dispatch(getAuthUserData(null, null, null, false))\r\n    }\r\n    ;\r\n}\r\n\r\n\r\nexport default AuthReducer;"]},"metadata":{},"sourceType":"module"}