{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\it\\\\MyFirstProject\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\it\\\\MyFirstProject\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"C:\\\\it\\\\MyFirstProject\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"C:\\\\it\\\\MyFirstProject\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{usersAPI}from\"../API/API\";import{updateObjectInArray}from\"../utils/validators/objHelp\";var FOLLOW='FOLLOW';var UNFOLLOW='UNFOLLOW';var SET_USERS='SET_USERS';var SET_CURRENT_PAGE='SET_CURRENT_PAGE';var SET_TOTAL_USERS_COUNT='SET_TOTAL_USERS_COUNT';var TOGGLE_IS_FETCHING='TOGGLE_IS_FETCHING';var TOGGLE_IS_FOLLOWING_PROGRESS='TOGGLE_IS_FOLLOWING_PROGRESS';var initialState={users:[],pageSize:10,totalUserCount:0,currentPage:1,isFetching:true,followingInProgress:[]};var usersReducer=function usersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case FOLLOW:return _objectSpread({},state,{users:updateObjectInArray(state.users,action.userId,'id',{followed:true})/*state.users.map(u => {\r\n                        if (u.id === action.userId) {\r\n                            return {...u, followed: true}\r\n                        }\r\n                        return u;\r\n                    })*/});case UNFOLLOW:return _objectSpread({},state,{users:updateObjectInArray(state.users,action.userId,'id',{followed:false})/*     users: state.users.map(u => {\r\n                         if (u.id === action.userId) {\r\n                             return {...u, followed: false}\r\n                         }\r\n                         return u;\r\n                     })*/});case SET_USERS:return _objectSpread({},state,{users:_toConsumableArray(action.users)});case SET_CURRENT_PAGE:return _objectSpread({},state,{currentPage:action.currentPage});case SET_TOTAL_USERS_COUNT:return _objectSpread({},state,{totalUserCount:action.count});case TOGGLE_IS_FETCHING:return _objectSpread({},state,{isFetching:action.isFetching});case TOGGLE_IS_FOLLOWING_PROGRESS:return _objectSpread({},state,{followingInProgress:action.isFetching?[].concat(_toConsumableArray(state.followingInProgress),[action.userId]):state.followingInProgress.filter(function(id){return id!=action.userId;})});default:return state;}};export var followSuccess=function followSuccess(userId){return{type:FOLLOW,userId:userId};};export var unfollowSuccess=function unfollowSuccess(userId){return{type:UNFOLLOW,userId:userId};};export var setUsers=function setUsers(users){return{type:SET_USERS,users:users};};export var setCurrentPage=function setCurrentPage(currentPage){return{type:SET_CURRENT_PAGE,currentPage:currentPage};};export var setTotalUsersCount=function setTotalUsersCount(totalUsersCount){return{type:SET_TOTAL_USERS_COUNT,count:totalUsersCount};};export var toggleIsFetching=function toggleIsFetching(isFetching){return{type:TOGGLE_IS_FETCHING,isFetching:isFetching};};export var toggleFollowingProgress=function toggleFollowingProgress(isFetching,userId){return{type:TOGGLE_IS_FOLLOWING_PROGRESS,isFetching:isFetching,userId:userId};};export var requestUsers=function requestUsers(page,pageSize){return(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(toggleIsFetching(true));dispatch(setCurrentPage(page));_context.next=4;return usersAPI.getUsers(page,pageSize);case 4:data=_context.sent;dispatch(toggleIsFetching(false));dispatch(setUsers(data.items));dispatch(setTotalUsersCount(data.totalCount));case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());};var followUnfollowFlow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,userId,apiMethod,actionCreator){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch(toggleFollowingProgress(true,userId));_context2.next=3;return apiMethod(userId);case 3:response=_context2.sent;if(response.data.resultCode==0){dispatch(actionCreator(userId));}dispatch(toggleFollowingProgress(false,userId));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function followUnfollowFlow(_x2,_x3,_x4,_x5){return _ref2.apply(this,arguments);};}();export var follow=function follow(userId){return(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:followUnfollowFlow(dispatch,userId,usersAPI.follow.bind(usersAPI),followSuccess);case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x6){return _ref3.apply(this,arguments);};}());};export var unfollow=function unfollow(userId){return(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:followUnfollowFlow(dispatch,userId,usersAPI.unfollow.bind(usersAPI),unfollowSuccess);case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x7){return _ref4.apply(this,arguments);};}());};export default usersReducer;","map":{"version":3,"sources":["C:/it/MyFirstProject/src/redux/UsersReducer.js"],"names":["usersAPI","updateObjectInArray","FOLLOW","UNFOLLOW","SET_USERS","SET_CURRENT_PAGE","SET_TOTAL_USERS_COUNT","TOGGLE_IS_FETCHING","TOGGLE_IS_FOLLOWING_PROGRESS","initialState","users","pageSize","totalUserCount","currentPage","isFetching","followingInProgress","usersReducer","state","action","type","userId","followed","count","filter","id","followSuccess","unfollowSuccess","setUsers","setCurrentPage","setTotalUsersCount","totalUsersCount","toggleIsFetching","toggleFollowingProgress","requestUsers","page","dispatch","getUsers","data","items","totalCount","followUnfollowFlow","apiMethod","actionCreator","response","resultCode","follow","bind","unfollow"],"mappings":"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","sourcesContent":["import {usersAPI} from \"../API/API\";\r\nimport {updateObjectInArray} from \"../utils/validators/objHelp\";\r\n\r\nconst FOLLOW = 'FOLLOW';\r\nconst UNFOLLOW = 'UNFOLLOW';\r\nconst SET_USERS = 'SET_USERS';\r\nconst SET_CURRENT_PAGE = 'SET_CURRENT_PAGE';\r\nconst SET_TOTAL_USERS_COUNT = 'SET_TOTAL_USERS_COUNT';\r\nconst TOGGLE_IS_FETCHING = 'TOGGLE_IS_FETCHING';\r\nconst TOGGLE_IS_FOLLOWING_PROGRESS = 'TOGGLE_IS_FOLLOWING_PROGRESS';\r\n\r\nlet initialState = {\r\n    users: [],\r\n    pageSize: 10,\r\n    totalUserCount: 0,\r\n    currentPage: 1,\r\n    isFetching: true,\r\n    followingInProgress: []\r\n}\r\n\r\nconst usersReducer = (state = initialState, action) => {\r\n\r\n    switch (action.type) {\r\n        case FOLLOW:\r\n            return {\r\n                ...state,\r\n                users: updateObjectInArray(state.users, action.userId, 'id', {followed: true})\r\n                /*state.users.map(u => {\r\n                        if (u.id === action.userId) {\r\n                            return {...u, followed: true}\r\n                        }\r\n                        return u;\r\n                    })*/\r\n            }\r\n        case UNFOLLOW:\r\n            return {\r\n                ...state,\r\n                users: updateObjectInArray(state.users, action.userId, 'id', {followed: false})\r\n                /*     users: state.users.map(u => {\r\n                         if (u.id === action.userId) {\r\n                             return {...u, followed: false}\r\n                         }\r\n                         return u;\r\n                     })*/\r\n\r\n            }\r\n        case SET_USERS:\r\n            return {...state, users: [...action.users]}\r\n        case SET_CURRENT_PAGE:\r\n            return {...state, currentPage: action.currentPage}\r\n        case SET_TOTAL_USERS_COUNT:\r\n            return {...state, totalUserCount: action.count}\r\n        case TOGGLE_IS_FETCHING:\r\n            return {...state, isFetching: action.isFetching}\r\n        case TOGGLE_IS_FOLLOWING_PROGRESS:\r\n            return {\r\n                ...state, followingInProgress: action.isFetching\r\n                    ? [...state.followingInProgress, action.userId]\r\n                    : state.followingInProgress.filter(id => id != action.userId)\r\n            }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\n\r\nexport const followSuccess = (userId) => ({\r\n    type: FOLLOW, userId\r\n})\r\nexport const unfollowSuccess = (userId) => ({\r\n    type: UNFOLLOW, userId\r\n})\r\nexport const setUsers = (users) => ({\r\n    type: SET_USERS, users\r\n})\r\nexport const setCurrentPage = (currentPage) => ({\r\n    type: SET_CURRENT_PAGE, currentPage\r\n})\r\nexport const setTotalUsersCount = (totalUsersCount) => ({\r\n    type: SET_TOTAL_USERS_COUNT, count: totalUsersCount\r\n})\r\nexport const toggleIsFetching = (isFetching) => ({\r\n    type: TOGGLE_IS_FETCHING, isFetching\r\n})\r\nexport const toggleFollowingProgress = (isFetching, userId) => ({\r\n    type: TOGGLE_IS_FOLLOWING_PROGRESS, isFetching, userId\r\n})\r\n\r\n\r\nexport const requestUsers = (page, pageSize) => {\r\n    return async (dispatch) => {\r\n\r\n        dispatch(toggleIsFetching(true));\r\n        dispatch(setCurrentPage(page));\r\n\r\n        let data = await usersAPI.getUsers(page, pageSize);\r\n        dispatch(toggleIsFetching(false));\r\n        dispatch(setUsers(data.items));\r\n        dispatch(setTotalUsersCount(data.totalCount));\r\n    }\r\n}\r\nconst followUnfollowFlow = async (dispatch, userId, apiMethod, actionCreator) => {\r\n    dispatch(toggleFollowingProgress(true, userId));\r\n\r\n    let response = await apiMethod(userId)\r\n\r\n    if (response.data.resultCode == 0) {\r\n        dispatch(actionCreator(userId))\r\n    }\r\n    dispatch(toggleFollowingProgress(false, userId));\r\n}\r\n\r\nexport const follow = (userId) => {\r\n    return async (dispatch) => {\r\n        followUnfollowFlow(dispatch, userId, usersAPI.follow.bind(usersAPI), followSuccess)\r\n    }\r\n}\r\nexport const unfollow = (userId) => {\r\n    return async (dispatch) => {\r\n        followUnfollowFlow(dispatch, userId, usersAPI.unfollow.bind(usersAPI), unfollowSuccess)\r\n    }\r\n}\r\n\r\nexport default usersReducer;\r\n"]},"metadata":{},"sourceType":"module"}